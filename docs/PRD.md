**Stack:** Vue 3 (Composition API) + Vuetify, Express.js, MongoDB, Passport (Google OAuth), Pinia, Vite, Vue I18n.  
**AI:** Hugging Face Inference API (zero-shot classification; small instruct LLM) with mock fallback.

## FINAL MATH ##

1) –í—Ä–µ–º—è –∏ —Å—É—â–Ω–æ—Å—Ç–∏

–î–µ–Ω—å –¥–∏—Å–∫—Ä–µ—Ç–∏–∑–∏—Ä—É–µ—Ç—Å—è –Ω–∞ —Ä–∞–≤–Ω—ã–µ —Å–ª–æ—Ç—ã –¥–ª–∏–Ω–æ–π Delta –º–∏–Ω—É—Ç (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 15).

–ú–Ω–æ–∂–µ—Å—Ç–≤–æ —Å–ª–æ—Ç–æ–≤: S = {s1, s2, ..., sm}. –ß–∞—Å –¥–Ω—è –¥–ª—è —Å–ª–æ—Ç–∞ s ‚Äî h(s) –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ [0, 24).

–ó–∞–¥–∞—á–∞ t –∏–º–µ–µ—Ç –ø–æ–ª—è:

d_t ‚Äî —Ç—Ä–µ–±—É–µ–º–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ –º–∏–Ω—É—Ç–∞—Ö,

q_t ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–π –∫—É—Å–æ–∫ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 30 –º–∏–Ω—É—Ç),

p_t ‚Äî –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –≤ [0, 1],

D_t ‚Äî –¥–µ–¥–ª–∞–π–Ω (timestamp, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ),

c_t ‚Äî –∫–∞—Ç–µ–≥–æ—Ä–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä: "–ü–∏—Ç–∞–Ω–∏–µ", "–£—á—ë–±–∞", "–û—Ç–¥—ã—Ö", "–ò–≥—Ä—ã", "–°–ø–æ—Ä—Ç", "–î–µ–ª–∞/–ü–æ—Ä—É—á–µ–Ω–∏—è", "–¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ", "–ö–æ–º–º—å—é—Ç", "–î—Ä—É–≥–æ–µ"),

fixed_time (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ‚Äî –∂—ë—Å—Ç–∫–æ –∑–∞–¥–∞–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–µ–∫—Ü–∏—è/–∫—Ä—É–∂–æ–∫).

2) –ò–µ—Ä–∞—Ä—Ö–∏—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤ (—Ñ–∞–∑–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –¥–µ–ª)

–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –¥–≤–µ —Ñ–∞–∑—ã.

–§–ê–ó–ê 0 (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –¥–µ–ª–∞, —Ä–∞–∑–º–µ—â–∞—é—Ç—Å—è –ø–µ—Ä–≤—ã–º–∏, —Ñ–æ—Ä–º–∏—Ä—É—é—Ç –º–∞—Å–∫–∏):

–°–æ–Ω: –∏–Ω—Ç–µ—Ä–≤–∞–ª [sleep_start, sleep_end] –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

–®–∫–æ–ª–∞/–£—Ä–æ–∫–∏: —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ/—Ä–∞—Å–ø–∏—Å–∞–Ω–Ω—ã–µ —É—Ä–æ–∫–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ –¥–Ω—è.

–°–µ–∫—Ü–∏–∏/–ö—Ä—É–∂–∫–∏/–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏: —Ç–æ–ª—å–∫–æ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

–ü–∏—Ç–∞–Ω–∏–µ (–ø–∏–Ω-—Å–ª–æ—Ç—ã):

–ó–∞–≤—Ç—Ä–∞–∫ 07:00‚Äì08:30,

–û–±–µ–¥ 12:00‚Äì14:00,

–£–∂–∏–Ω 18:00‚Äì20:30.
–í—Å–µ —ç—Ç–∏ –±–ª–æ–∫–∏ —Å—á–∏—Ç–∞—é—Ç—Å—è –∑–∞–Ω—è—Ç—ã–º–∏, —Ñ–æ—Ä–º–∏—Ä—É—é—Ç –∂—ë—Å—Ç–∫–∏–µ –º–∞—Å–∫–∏: –≤–Ω—É—Ç—Ä–∏ –Ω–∏—Ö –Ω–µ–ª—å–∑—è —Ä–∞–∑–º–µ—â–∞—Ç—å –¥—Ä—É–≥–∏–µ –∑–∞–¥–∞—á–∏.

–§–ê–ó–ê 1 (–æ—Å—Ç–∞–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏ –ø–æ –º–æ–¥–µ–ª–∏ –ø–æ–ª–µ–∑–Ω–æ—Å—Ç–∏):

–†–∞–∑–º–µ—â–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —Å–ª–æ—Ç—ã, –Ω–µ –∑–∞–Ω—è—Ç—ã–µ —Ñ–∞–∑–æ–π 0.

3) –ñ—ë—Å—Ç–∫–∏–µ –º–∞—Å–∫–∏ (admissible slots)

–û–ø—Ä–µ–¥–µ–ª–∏–º –±–∏–Ω–∞—Ä–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é mask(t, s):

mask(t, s) = 0, –µ—Å–ª–∏ s –ø–æ–ø–∞–¥–∞–µ—Ç —Ö–æ—Ç—è –±—ã –≤ –æ–¥–∏–Ω –∏–∑ –∂—ë—Å—Ç–∫–∏—Ö –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤:

—Å–æ–Ω,

—É—Ä–æ–∫–∏/—à–∫–æ–ª–∞,

—Å–µ–∫—Ü–∏–∏/–∫—Ä—É–∂–∫–∏/—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ (fixed_time),

–æ–∫–Ω–∞ –ø–∏—Ç–∞–Ω–∏—è (–∫—Ä–æ–º–µ —Å–∞–º–æ–π –∑–∞–¥–∞—á–∏ "–ü–∏—Ç–∞–Ω–∏–µ" —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ —Ç–∏–ø–∞).

–í–æ –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–ª—É—á–∞—è—Ö mask(t, s) = 1.

–î–æ–ø—É—Å—Ç–∏–º–æ–µ –º–Ω–æ–∂–µ—Å—Ç–≤–æ: S_adm(t) = { s in S | mask(t, s) = 1 }.

4) –í–µ–∫—Ç–æ—Ä –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ x(t, s)

–î–ª—è –∫–∞–∂–¥–æ–π –ø–∞—Ä—ã (t, s), –≥–¥–µ s ‚àà S_adm(t), –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –≤–µ–∫—Ç–æ—Ä x(t, s) = [x1, ..., x12]^T.
–í—Å–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ –Ω–æ—Ä–º–∏—Ä–æ–≤–∞–Ω—ã –≤ [-1, 1], –∫—Ä–æ–º–µ —è–≤–Ω–æ –æ–≥–æ–≤–æ—Ä—ë–Ω–Ω—ã—Ö.

–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è:

h = h(s) ‚Äî —á–∞—Å –¥–Ω—è –¥–ª—è —Å–ª–æ—Ç–∞ s (–≤–µ—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ —á–∏—Å–ª–æ –≤ [0, 24)).

delta_deadline_hours = max(0, D_t - start(s)) –≤ —á–∞—Å–∞—Ö; –µ—Å–ª–∏ –¥–µ–¥–ª–∞–π–Ω–∞ –Ω–µ—Ç, –ø—Ä–∏–Ω–∏–º–∞–µ–º 0.

used_before_s ‚Äî —É–∂–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–∏–Ω—É—Ç—ã –¥–æ –Ω–∞—á–∞–ª–∞ s (–ø–æ —Ç–µ–∫—É—â–µ–º—É –ø–ª–∞–Ω—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è).

L = 360 (6 —á–∞—Å–æ–≤) ‚Äî –º—è–≥–∫–∞—è –¥–Ω–µ–≤–Ω–∞—è "–∫–≤–æ—Ç–∞" —É–º—Å—Ç–≤–µ–Ω–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏.

x1: Circadian fit (—à–∞–≥–æ–≤—ã–µ –∫—Ä–∏–≤—ã–µ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ c_t)

–µ—Å–ª–∏ c_t == "–ü–∏—Ç–∞–Ω–∏–µ":
  x1 = +1 –≤–Ω—É—Ç—Ä–∏ —Å–≤–æ–µ–≥–æ –æ–∫–Ω–∞ (–ó–∞–≤—Ç—Ä–∞–∫/–û–±–µ–¥/–£–∂–∏–Ω), –∏–Ω–∞—á–µ -1
–µ—Å–ª–∏ c_t == "–£—á—ë–±–∞/–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ":
  16 <= h < 19.5 -> +1
  19.5 <= h < 21 -> +0.2
  –∏–Ω–∞—á–µ -> -0.5
–µ—Å–ª–∏ c_t == "–û—Ç–¥—ã—Ö":
  18 <= h < 21 -> +1
  16 <= h < 18 -> +0.5
  h  < 10     -> -0.5
  –∏–Ω–∞—á–µ -> 0
–µ—Å–ª–∏ c_t == "–ò–≥—Ä—ã":
  17 <= h <= 20 -> +1
  12 <= h < 17 ->  0
  h  < 12     -> -1
  –∏–Ω–∞—á–µ -> 0
–µ—Å–ª–∏ c_t == "–°–ø–æ—Ä—Ç":
  17 <= h < 20 -> +1
  10 <= h < 17 ->  0
  –∏–Ω–∞—á–µ -> -0.5
–µ—Å–ª–∏ c_t == "–î–µ–ª–∞/–ü–æ—Ä—É—á–µ–Ω–∏—è":
  12 <= h < 17 -> +0.6
  h  < 9      -> -0.3
  –∏–Ω–∞—á–µ -> 0
–µ—Å–ª–∏ c_t == "–¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ":
  18 <= h < 21 -> +0.7
  14 <= h < 18 -> +0.3
  h  < 10     -> -0.2
  –∏–Ω–∞—á–µ -> 0
–∏–Ω–∞—á–µ:
  x1 = 0


x2: –î–∞–≤–ª–µ–Ω–∏–µ –¥–µ–¥–ª–∞–π–Ω–∞

tau_hours = 6
x2 = 1 - exp( - delta_deadline_hours / tau_hours )
(–µ—Å–ª–∏ –¥–µ–¥–ª–∞–π–Ω–∞ –Ω–µ—Ç, x2 = 0)


x3: –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç

x3 = p_t   (–≤ [0,1])


x4: –°—Ç–æ–∏–º–æ—Å—Ç—å –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (–≥—Ä–∞–Ω–∏—Ü–∞ —Å–ª–æ—Ç–æ–≤)

x4 = +1 –µ—Å–ª–∏ —Å–æ—Å–µ–¥–Ω–∏–µ –∑–∞–Ω—è—Ç—ã–µ —Å–ª–æ—Ç—ã —Ç–æ–π –∂–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
x4 = -1 –µ—Å–ª–∏ —Å–æ—Å–µ–¥–Ω–∏–µ –∑–∞–Ω—è—Ç—ã–µ —Å–ª–æ—Ç—ã –¥—Ä—É–≥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
x4 =  0 –µ—Å–ª–∏ —Å–æ—Å–µ–¥–µ–π –Ω–µ—Ç –∏–ª–∏ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ


x5: –ù–∞–∫–æ–ø–ª–µ–Ω–Ω–∞—è –¥–Ω–µ–≤–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞

–µ—Å–ª–∏ used_before_s <= L: x5 = 0
–∏–Ω–∞—á–µ: x5 = -min(1, (used_before_s - L) / 120)


x6: –ü—Ä–∏–≤—ã—á–∫–∞/–∏—Å—Ç–æ—Ä–∏—è

x6 ‚àà [-1, 1]; —ç—Ç–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–Ω–∞—è EMA —á–∞—Å—Ç–æ—Ç—ã –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã—Ö (y=1) —Ä–∞–∑–º–µ—â–µ–Ω–∏–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ c_t –æ–∫–æ–ª–æ —á–∞—Å–∞ h.


x7: –ö–æ–Ω—Ñ–ª–∏–∫—Ç —Å –ø–∏—Ç–∞–Ω–∏–µ–º

–µ—Å–ª–∏ c_t == "–ü–∏—Ç–∞–Ω–∏–µ" –∏ s –≤–Ω—É—Ç—Ä–∏ –æ–∫–Ω–∞ (—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ –ø—Ä–∏—ë–º–∞ –ø–∏—â–∏): x7 = +1
–µ—Å–ª–∏ c_t == "–ü–∏—Ç–∞–Ω–∏–µ" –∏ s –≤–Ω–µ –æ–∫–Ω–∞: x7 = -1
–µ—Å–ª–∏ c_t != "–ü–∏—Ç–∞–Ω–∏–µ" –∏ s –≤–Ω—É—Ç—Ä–∏ –ª—é–±–æ–≥–æ –æ–∫–Ω–∞ –ø–∏—Ç–∞–Ω–∏—è: x7 = -1
–∏–Ω–∞—á–µ: x7 = 0


x8: –ö–æ–Ω—Ñ–ª–∏–∫—Ç —Å —É—Ä–æ–∫–∞–º–∏ (—Ç–æ–ª—å–∫–æ –¥–µ—Ç—Å–∫–∏–π –ø—Ä–æ—Ñ–∏–ª—å)

x8 = -1 –µ—Å–ª–∏ s –ø–æ–ø–∞–¥–∞–µ—Ç –≤ —É—Ä–æ–∫, –∏–Ω–∞—á–µ 0


x9: –ö–æ–Ω—Ñ–ª–∏–∫—Ç —Å–æ —Å–Ω–æ–º

x9 = -1 –µ—Å–ª–∏ s –ø–æ–ø–∞–¥–∞–µ—Ç –≤ —Å–æ–Ω, –∏–Ω–∞—á–µ 0


x10: –î–Ω–µ–≤–Ω–∞—è —Ü–µ–ª—å –æ—Ç–¥—ã—Ö–∞ (—Ç–æ–ª—å–∫–æ –¥–µ—Ç—Å–∫–∏–π –ø—Ä–æ—Ñ–∏–ª—å)

–µ—Å–ª–∏ c_t in {"–û—Ç–¥—ã—Ö","–ü—Ä–æ–≥—É–ª–∫–∞"} –∏ —Å—É–º–º–∞ —É–∂–µ —Å–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –æ—Ç–¥—ã—Ö–∞ —Å–µ–≥–æ–¥–Ω—è < 60 –º–∏–Ω: x10 = +1
–∏–Ω–∞—á–µ: x10 = 0


x11: –®—Ç—Ä–∞—Ñ –∑–∞ –ø–æ–∑–¥–Ω—é—é –¥–æ–º–∞—à–∫—É (—Ç–æ–ª—å–∫–æ –¥–µ—Ç—Å–∫–∏–π –ø—Ä–æ—Ñ–∏–ª—å)

–µ—Å–ª–∏ c_t == "–£—á—ë–±–∞/–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ" –∏ h >= 20.0: x11 = -1
–µ—Å–ª–∏ c_t == "–£—á—ë–±–∞/–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ" –∏ 19.0 <= h < 20.0: x11 = -0.5
–∏–Ω–∞—á–µ: x11 = 0


x12: –®—Ç—Ä–∞—Ñ –∑–∞ –∏–≥—Ä—ã —É—Ç—Ä–æ–º

–µ—Å–ª–∏ c_t == "–ò–≥—Ä—ã" –∏ h < 12.0: x12 = -1
–µ—Å–ª–∏ c_t == "–ò–≥—Ä—ã" –∏ 12.0 <= h < 15.0: x12 = -0.5
–µ—Å–ª–∏ c_t == "–ò–≥—Ä—ã" –∏ 17.0 <= h <= 20.0: x12 = +0.5
–∏–Ω–∞—á–µ: x12 = 0

5) –ü–æ–ª–µ–∑–Ω–æ—Å—Ç—å –∏ –≤—ã–±–æ—Ä —Å–ª–æ—Ç–∞

–ü–æ–ª–µ–∑–Ω–æ—Å—Ç—å (–ª–∏–Ω–µ–π–Ω–∞—è):

U(t, s) = dot(w, x(t, s))   # w –∏ x ‚Äî –≤–µ–∫—Ç–æ—Ä—ã –¥–ª–∏–Ω—ã 12


–í—ã–±–æ—Ä —è–∫–æ—Ä–Ω–æ–≥–æ —Å–ª–æ—Ç–∞:

s_star(t) = argmax_{s ‚àà S_adm(t)} U(t, s)


–†–æ—Å—Ç –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞ –¥–æ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ d_t:

1) –ù–∞—á–∞—Ç—å —Å s_star(t);
2) –ñ–∞–¥–Ω–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å –≤ —Å–æ—Å–µ–¥–Ω–∏–µ –¥–æ–ø—É—Å—Ç–∏–º—ã–µ —Å–ª–æ—Ç—ã, –º–∞–∫—Å–∏–º–∏–∑–∏—Ä—É—è –°–†–ï–î–ù–Æ–Æ –ø–æ–ª–µ–∑–Ω–æ—Å—Ç—å —Å–µ–≥–º–µ–Ω—Ç–∞;
3) –°–æ–±–ª—é–¥–∞—Ç—å min-–∫—É—Å–æ–∫ q_t;
4) –†–∞–∑—Ä–µ—à–µ–Ω—ã –º–∞–∫—Å–∏–º—É–º 2 —Å–µ–≥–º–µ–Ω—Ç–∞ –¥–ª—è –æ–¥–Ω–æ–π –∑–∞–¥–∞—á–∏; –¥–ª—è –≤—Ç–æ—Ä–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è —à—Ç—Ä–∞—Ñ phi = -0.2 –∫ —Å—Ä–µ–¥–Ω–µ–π –ø–æ–ª–µ–∑–Ω–æ—Å—Ç–∏ –ø—Ä–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –Ω–∞ —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ.


–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤:

urgency(t) = p_t * max_s x2(t, s)   # –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç * –¥–∞–≤–ª–µ–Ω–∏–µ –¥–µ–¥–ª–∞–π–Ω–∞
–ó–∞–¥–∞—á–∏ –ø–ª–∞–Ω–∏—Ä—É—é—Ç—Å—è –ø–æ —É–±—ã–≤–∞–Ω–∏—é urgency; –ø—Ä–∏ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–∏ –º–µ–Ω–µ–µ —Å—Ä–æ—á–Ω–∞—è –∑–∞–¥–∞—á–∞ –ø–µ—Ä–µ—Ä–∞–∑–º–µ—â–∞–µ—Ç—Å—è.

6) –õ–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥—Ä–µ—Å—Å–∏—è (–≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø—Ä–∏–Ω—è—Ç–∏—è) –∏ SGD

–ú—ã –æ–±—É—á–∞–µ–º –≤–µ—Å–∞ w –ø–æ –±–∏–Ω–∞—Ä–Ω—ã–º –º–µ—Ç–∫–∞–º y ‚àà {0,1} –¥–ª—è –ø–∞—Ä (t, s), –≥–¥–µ:

y = 1 ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏–Ω—è–ª —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ (–æ—Å—Ç–∞–≤–∏–ª –∫–∞–∫ –µ—Å—Ç—å) –∏–ª–∏ —Å–∞–º –ø–µ—Ä–µ—Ç–∞—â–∏–ª –∑–∞–¥–∞—á—É –≤ (t, s) –∏ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª,

y = 0 ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–≤–µ—Ä–≥/–ø–µ—Ä–µ–¥–≤–∏–Ω—É–ª –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –∏–ª–∏ –¥–∞–ª –Ω–µ–≥–∞—Ç–∏–≤–Ω—É—é –æ—Ü–µ–Ω–∫—É.

–°–∏–≥–º–æ–∏–¥–∞ –∏ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:

sigma(z) = 1 / (1 + exp(-z))
P(y=1 | x) = sigma( dot(w, x) )


–§—É–Ω–∫—Ü–∏—è –ø–æ—Ç–µ—Ä—å (–ª–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–∞—è —Å L2-—Ä–µ–≥—É–ª—è—Ä–∏–∑–∞—Ü–∏–µ–π):

loss = - ( y*log(P) + (1 - y)*log(1 - P) ) + (lambda/2) * ||w||^2
–≥–¥–µ P = sigma(dot(w, x)), lambda > 0


–ì—Ä–∞–¥–∏–µ–Ω—Ç –∏ —à–∞–≥ SGD (–æ–Ω–ª–∞–π–Ω, –ø–æ –æ–¥–Ω–æ–º—É –ø—Ä–∏–º–µ—Ä—É):

grad = (P - y) * x + lambda * w
w = w - eta * grad
–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏: eta = 0.05, lambda = 0.001


–ó–∞–º–µ—á–∞–Ω–∏—è –ø–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏:

–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø—Ä–∏–∑–Ω–∞–∫–æ–≤, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –∂—ë—Å—Ç–∫–∏–º –ø—Ä–∞–≤–∏–ª–∞–º (x7, x8, x9), –æ–±–Ω—É–ª—è—Ç—å –ø–µ—Ä–µ–¥ —à–∞–≥–æ–º SGD, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–Ω–∞—Ç–µ–ª—å–Ω–æ –Ω–∞—Ä—É—à–∏–ª –æ–∫–Ω–æ —Å–Ω–∞/–ø–∏—Ç–∞–Ω–∏—è/—É—Ä–æ–∫–æ–≤. –≠—Ç–æ –Ω–µ –¥–∞—Å—Ç –º–æ–¥–µ–ª–∏ "—Ä–∞–∑—É—á–∏—Ç—å" –±–∞–∑–æ–≤—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è.

–®—Ç—Ä–∞—Ñ—ã-–ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è (x11, x12) –Ω–µ –º–∞—Å–∫–∏—Ä–æ–≤–∞—Ç—å ‚Äî –æ–Ω–∏ –¥–æ–ª–∂–Ω—ã –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –ø–æ–¥ —Ä–µ–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å–µ–º—å–∏/—Ä–µ–±—ë–Ω–∫–∞.

–ü—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏ –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–ª–∏–ø–ø–∏–Ω–≥ –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞ –ø–æ L2-–Ω–æ—Ä–º–µ –¥–æ –ø–æ—Ä–æ–≥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 5.0) –¥–ª—è —á–∏—Å–ª–µ–Ω–Ω–æ–π —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏; bias-—Ç–µ—Ä–º –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è (–∏–Ω—Ç–µ—Ä—Å–µ–ø—Ç –º–æ–∂–Ω–æ —Å–º–æ–¥–µ–ª–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–º x0=1 –∏ w0, –Ω–æ –≤ –±–∞–∑–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω).

7) –ë–∞–∑–æ–≤—ã–µ –≤–µ—Å–∞ (–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è)

–ü–æ—Ä—è–¥–æ–∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç [x1 .. x12].

–î–ª—è –¥–µ—Ç—Å–∫–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é):

w_kid = [ 0.55, 0.45, 0.50, -0.25, -0.15, 0.30, -0.95, -1.10, -1.30, 0.40, -0.70, -0.80 ]


–î–ª—è –≤–∑—Ä–æ—Å–ª–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è (–Ω–∞ –±—É–¥—É—â–µ–µ, –µ—Å–ª–∏ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è):

w_adult = [ 0.55, 0.50, 0.55, -0.25, -0.20, 0.35, -0.90, 0.00, -1.20, 0.15, 0.00, 0.00 ]

8) –ü—Ä–∏–º–µ—á–∞–Ω–∏—è –∫ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –∏ –∫–∞—á–µ—Å—Ç–≤—É

–ë–ª–∞–≥–æ–¥–∞—Ä—è —Ñ–∞–∑–µ 0 –±–∞–∑–æ–≤—ã–µ –¥–µ–ª–∞ —Ä–µ–±—ë–Ω–∫–∞ (—Å–æ–Ω, –µ–¥–∞, —à–∫–æ–ª–∞, —Å–µ–∫—Ü–∏–∏) –≤—Å–µ–≥–¥–∞ –∑–∞–Ω–∏–º–∞—é—Ç —Å–≤–æ–∏ –æ–∫–Ω–∞ –∏ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –≤—ã—Ç–µ—Å–Ω—è—é—Ç—Å—è –∞–±—Å—É—Ä–¥–Ω—ã–º–∏ –∑–∞–¥–∞—á–∞–º–∏ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É.

–õ–∏–Ω–µ–π–Ω–∞—è –ø–æ–ª–µ–∑–Ω–æ—Å—Ç—å –∏ –∂–∞–¥–Ω—ã–π —Ä–æ—Å—Ç —Å–µ–≥–º–µ–Ω—Ç–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç –ø—Ä–æ—Å—Ç–æ—Ç—É –∏ —Å–∫–æ—Ä–æ—Å—Ç—å (<= 800 –º—Å –ø—Ä–∏ <= 50 –∑–∞–¥–∞—á/–¥–µ–Ω—å).

SGD –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–æ–¥—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç —Å—É–±—ä–µ–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è, –Ω–µ –ª–æ–º–∞—è –∂—ë—Å—Ç–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞ (–∑–∞ —Å—á—ë—Ç –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏—è x7/x8/x9 –≤ —à–∞–≥–∞—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è, –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏—Ö –Ω–∞—Ä—É—à–∞–µ—Ç –≤—Ä—É—á–Ω—É—é).

–î–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤: –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –±–ª–æ–∫–∏ —Ñ–∞–∑—ã 0 —Å–æ–∑–¥–∞—é—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –Ω–∞ –¥–∞—Ç—É; –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å (userId, date, title, start, end).

---

## 1. Problem & Goals
Users add tasks but fail to place them into a realistic day. The app generates a **balanced timetable** (when & how long) for a single day, respects sleep/work windows, and **learns** from edits.

### Success (v1)
- Enter tasks ‚Üí one-click schedule with explanations.
- Drag/resize edits update a **personal model** via SGD + logistic regression.
- ‚ÄúPrevious tasks‚Äù quick-add.
- EN/RU localization; Google login; fast (‚â§800 ms for ‚â§50 tasks).

### Non-Goals
- Team features, multi-day optimization, full Google Calendar sync (can be later).

---

## 2. Core Concepts
- **Task**: title, estimated minutes, priority (0‚Äì1), optional deadline/window/fixed time.
- **Time slot**: 15-min blocks across a day.
- **Admissible slot**: not in sleep/locked windows and not already allocated.
- **Utility**: score for placing task t in slot s.

---

## 3. Mathematical Model

Let tasks \(T=\{t_1,\dots,t_n\}\) and slots \(S=\{s_1,\dots,s_m\}\).

**Utility:**
\[
U(t,s) = \sum_{i=1}^k w_i \, f_i(t,s)
\]
- \(f_i(t,s)\): value of the i-th factor (e.g., circadian fit, deadline pressure, priority, habit, context switch, daily load).
- \(w_i\): learnable weight representing user preference.

**Slot choice:**
\[
s^*(t) = \arg\max_{s \in S_{\text{admissible}}} U(t,s)
\]

**Duration allocation:** Expand from \(s^*(t)\) into adjacent admissible slots that maximize **average** utility until duration \(d(t)\) is met. If fragmentation is needed, pick top-K segments with min chunk (e.g., 30 min).

### Feature Vector (examples)
1. **Circadian fit** (category √ó time-of-day).  
2. **Deadline pressure** (higher near deadline).  
3. **Priority** [0..1].  
4. **Context switch cost** (penalty if neighbors have different category).  
5. **User load** (penalty after preferred daily limit).  
6. **Habit/history** (boost if similar tasks commonly done at this time).

Normalize features to [‚àí1,1] (or [0,1]) and store per evaluation.

---

## 4. Learning From Feedback (SGD + Logistic Regression)

Binary label \(y \in \{0,1\}\) per (t,s):
- \(y=1\): user accepted placement, or moved task and kept it (positive).
- \(y=0\): user overrode a placement or thumbed-down.

Model:
\[
P(y=1|x) = \sigma(w^\top x) = \frac{1}{1+e^{-w^\top x}}
\]

Online update (per interaction), learning rate \( \eta \):
- Error \(e=\sigma(w^\top x)-y\)  
- Gradient \( \nabla = e \cdot x \)  
- Update \( w \leftarrow w - \eta (\nabla + \lambda w) \) with L2 \( \lambda \)

Inference uses **logit** \(U(t,s)=w^\top x\) to rank slots.

**Cold start:** heuristic \(w_0\) and rules; begin learning when ‚â•20 labeled pairs.

---

## 5. Scheduling Algorithm

1. Build slots S (15-min) and mark forbidden (sleep/locks).
2. For each task t:
   - Compute features \(x(t,s)\) for admissible s.
   - Score \(U=w^\top x\); choose \(s^*(t)\); **grow** segment to duration.
3. Resolve overlaps by descending **urgency = priority √ó deadline pressure**.
4. Store final plan and explanations.

Pseudocode:
txt
for t in sortByUrgency(tasks):
  best = argmax_s dot(w, features(t, s))
  segment = grow(best, duration=t.d)
  place(t, segment)
resolve_overlaps()

## 6). AI Usage
6.1 Categorization (free)
Zero-shot classification (HF Inference API).

Labels: Healthcare, Sport activity, Deep work, Admin/Errands, Learning, Social, Household, Creative, Commute, Other.

On save ‚Üí assign {category, confidence}; user can override.

6.2 Reasoning
Small instruct model (HF) returns 1‚Äì2 sentence explanation using top features and constraints.

If provider unavailable ‚Üí template fallback:

‚ÄúPlaced {title} at {time} for {duration} due to high {feature1} and {feature2}, no conflict with sleep/locks. Deadline pressure: {dp}.‚Äù

## 7). Data Model (Mongo)
users
_id, email, name, locale, sleep_start, sleep_end, work_start, work_end, model:{ w:[Number], updatedAt }

tasks
_id, userId, title, description, estimatedMinutes, priority, deadline?, desiredWindow?, fixedTime?, category, ai:{label, confidence, provider}, archived, createdAt, updatedAt

plans
_id, userId, date, slots:[{ start, end, taskId, score, featuresSnapshot, reasoningText }], createdAt

feedback
_id, userId, taskId, planId, slot:{start,end}, label:0|1, source:'kept'|'moved'|'thumbs', note?, createdAt

catalog (Previous tasks)
_id, userId, taskTemplate:{ title, defaultMinutes, defaultPriority, category }, lastUsedAt, uses

## 8). API (Express)
Auth

GET /auth/google ‚Üí OAuth

GET /auth/google/callback

GET /me

Tasks

GET /tasks

POST /tasks ‚Üí categorize with AI

PUT /tasks/:id

DELETE /tasks/:id

GET /catalog

POST /catalog

Schedule

POST /schedule/calculate { date, tasks? } ‚Üí plan with slots + reasoning

POST /schedule/feedback { planId, entries:[{taskId, slot, label, note?}] } ‚Üí SGD update

POST /schedule/apply-edits { planId, patches:[{taskId, from,to}] } ‚Üí log positives, optional re-calc

Settings

PUT /settings (sleep/work, locale)

Debug

GET /model (current w)

POST /model/reset

## 9). Frontend UX (Vue + Vuetify)
Day calendar (Google Calendar‚Äìlike), 15-min grid, drag/resize, category colors, priority badges.

Task Drawer: create/edit; AI category chips; quick-add from Previous tasks.

Explanation Panel: reasons per event; quick thumbs up/down.

Top Bar: Calculate, EN/RU switch, user menu.

Empty state: 1-minute tutorial.

Dark/Light modes.

## 10). Localization
Vue I18n with en.json and ru.json; all UI strings translatable.

Date/time localized (date-fns).

Requirement: the app itself supports RU/EN, not the PRD content.

## 11). Metrics
Acceptance rate (y=1), edits per plan, time to schedule, Œîw magnitude, DAU, task reuse.

## 12). Test Plan (smoke)
Create 10 tasks; schedule < 800 ms.

Move 3 tasks; submit feedback; verify weights change and next plan differs.

AI offline ‚Üí fallback explanations shown.

RU toggle switches all strings and formats.

## 13). Defaults
Granularity: 15 min; Min chunk: 30 min.

ùë§
0
w 
0
‚Äã
 : [0.6, 0.5, 0.6, -0.3, -0.2, 0.4]

Learning: 
ùúÇ
=
0.05
Œ∑=0.05, 
ùúÜ
=
0.001
Œª=0.001